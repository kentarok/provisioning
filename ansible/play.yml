---
- name: playbook for ansible tower
  hosts: all
  vars:
    TOWER_VER: 3.6.0-1
    TOWER_CHECKSUM: be111c823e369f5d25445a309502168225d8ce9a41dd7294ccdff09be4cb3c04
  
  tasks:
    - name: download
      get_url: 
        url: "https://releases.ansible.com/ansible-tower/setup/ansible-tower-setup-{{ TOWER_VER }}.tar.gz"
        dest: "/tmp/ansible-tower-setup-{{ TOWER_VER }}.tar.gz"
      
    - name: untar the tarball
      command: "tar -xzf /tmp/ansible-tower-setup-{{ TOWER_VER }}.tar.gz -C /tmp"

    - name: download inventory
      get_url:
        url: https://raw.githubusercontent.com/kentarok/provisioning/master/ansible/inventory
        dest: "/tmp/ansible-tower-setup-{{ TOWER_VER }}/inventory"

    - name: install ansible tower
      command: ./setup.sh
      args:
        chdir: "/tmp/ansible-tower-setup-{{ TOWER_VER }}"
 
    - name: add user
      user:
        name: automate
        comment: "automatically generated by ansible"
        uid: 2001
        group: myusers
        
    - name: add authorized_keys
      authorized_key:
        user: automate
        state: present
        key: "ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAACAQDYpmDmBg0vSnz/oNM7rCdC+sUXFo2SXw+nPPMpdGiR9rcjvURbdXUqBTqRNrkb+PrxnYiOPxK1sRrEUE47C005na1tKgqXErpkDRMZokDh/6XuqNB7xnMFzLHmc7PeCJz6JrKN45lJg3G0dGogepi8W6iqsT9J8v0r1c9k4pBc8RuDUamz9yili37BBc90gQfLDKFX+iAbcdCLSue0YBWmig+zmIb6VnqBblMxXts/wl2vgcgwU1pxeBbTUmOfdNxq4LGOE1/hSwEcxg/prTJoFmmWMjc2qqHnRO/f+VUPRt4QkRsc0VsAf/7i5z6c56oDPzIfB5mUV+r3LDjfRIgQtH0ZG4axMe9PtA3wAVeuVes+iADBCe25hrN1SCGZy7jTISzGYQmtM2RFSEkRjKzN24Nt01d4A7DaPTicASp0S5xfLVE/sU7XT6h2AtquermJly4vOYuFCl3/Asz+yct0fNDtbsBYLaOQi+lL0f2ny4BptK8nPCg8zmo+BNcROjp2Zj3WCJawbVIy41CF3xZ1E6I/Q8nWMp+5fuFEb7R4WUGhQU+cAVH60Ao2SShB2t+Q4LhRn6X77SO3u+LaXfA79zU7xq1xxVpTVTAws3a7A6oxtyh2T5bCVZEQxYVcLpgXwkFqhck8cPTtqNcSDQlkpaPZfS55KCa6w1kM/lYYRw=="
          
